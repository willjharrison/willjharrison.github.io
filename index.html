<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sensory Intelligence Research Group</title>
  <meta name="color-scheme" content="dark light" />
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#000; --fg:#b6fdb6; --glow:#19ff19;
      --rainColor: hsla(120, 80%, 20%, 1);
      --cardBg: rgba(10, 25, 10, 0.85);
      --cardBorder: rgba(80, 200, 120, 0.3);
      --maxW: 980px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto}

    /* Background rain */
    #matrix{position:fixed;inset:0;z-index:0;display:block;width:100%;height:100%;
      background:radial-gradient(1200px 800px at 50% 50%, #001600 0%, #000 80%)}

    /* Page container */
    .wrap{position:relative;z-index:1;max-width:var(--maxW);margin:24px auto 80px; padding:0 16px}

    h1{font-family:'VT323', monospace; margin:12px 0 16px 0;text-align:center;letter-spacing:.06em;font-weight:700;font-size:clamp(28px,7vw,80px);
      color:#D4EB8E;
      text-shadow:
        0 0 .2rem #66ccff,
        0 0 .2rem #66ccff,
        0 0 .4rem #66ccff,
        0 0 .6rem var(--glow),
        0 0 1.2rem var(--glow),
        0 0 2.4rem var(--glow);
      filter:contrast(1.05) saturate(1.1) drop-shadow(0 0 .25rem #0a460a)}

    .cards{display:grid; gap:14px}

    details.card{
      background:var(--cardBg);
      border:1px solid var(--cardBorder);
      border-radius:14px;
      box-shadow:0 10px 40px rgba(0,0,0,.5), 0 0 30px rgba(25,255,60,.08) inset;
      overflow:hidden;
    }
    summary{
      cursor:pointer;
      list-style:none;
      padding:16px 18px;
      font-family:'VT323', monospace;
      font-size:clamp(20px,4.4vw,38px);
      color:#D4EB8E;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .chev{transition:transform .15s ease}
    details[open] .chev{transform:rotate(90deg)}
    .content{padding:10px 18px 18px; line-height:1.5; font-size:16px; white-space:pre-wrap}
    .small{font-size:12px; opacity:.7; margin:0 18px 14px}

    footer{position:relative;z-index:1;text-align:center;font-size:12px;opacity:.6;margin:22px 0}

    @media (prefers-reduced-motion: reduce){
      #matrix{display:none}
    }
  </style>
</head>
<body>
  <canvas id="matrix" aria-hidden="true"></canvas>

  <div class="wrap">
    <h1 id="title">Sensory Intelligence Research Group</h1>
    <div class="cards">
      <details class="card" id="sec-about">
        <summary>ABOUT <span class="chev">›</span></summary>
        <div class="content" data-src="about.txt">Loading…</div>
      </details>

      <details class="card" id="sec-collab">
        <summary>COLLABORATORS <span class="chev">›</span></summary>
        <div class="content" data-src="collaborators.txt">Loading…</div>
      </details>

      <details class="card" id="sec-opps">
        <summary>OPPORTUNITIES <span class="chev">›</span></summary>
        <div class="content" data-src="opportunities.txt">Loading…</div>
      </details>
    </div>

    <footer>© <span id="y"></span> SIRG</footer>
  </div>

  <script>
  // ======= MATRIX RAIN (fixed: no duplicate let declarations; robust dt clamp) =======
  (() => {
    const c = document.getElementById('matrix');
    const ctx = c.getContext('2d');

    const glyphs = 'アイウエオカキクケコサシスセソ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ@#$%&*';
    const RAIN = {
      rowsPerSec: 20, variability: 2, spacing: 0.85, trail: 0.02,
      minRowsPerSec: 10, minFactor: 0.10, maxGlyphStepsPerFrame: 2
    };

    let dpr=1, w=0, h=0, cols=0, fontSize=16, glyphSpacing=14;
    let yRows=[], velRows=[], rowFrac=[], lastRow=[];
    let lastTs=0;

    function sampleVel(){
      const raw = 1 + (Math.random()*2 - 1) * RAIN.variability;
      const clamped = Math.max(RAIN.minFactor, raw);
      return Math.max(RAIN.minRowsPerSec, RAIN.rowsPerSec * clamped);
    }

    function resize(){
      dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
      w = window.innerWidth; h = window.innerHeight;
      c.width = Math.floor(w*dpr); c.height = Math.floor(h*dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);

      fontSize = Math.max(12, Math.floor(w/70));
      glyphSpacing = Math.round(fontSize * RAIN.spacing);
      ctx.font = fontSize + 'px monospace';
      ctx.textBaseline = 'top'; ctx.textAlign = 'left';

      cols   = Math.max(1, Math.ceil(w / glyphSpacing));
      yRows  = Array(cols).fill(0).map(()=> -Math.random()*50);
      velRows= Array(cols).fill(0).map(()=> sampleVel());
      rowFrac= Array(cols).fill(0);
      lastRow= Array(cols).fill(-1);
    }
    window.addEventListener('resize', resize, {passive:true});
    resize();

    function frame(ts){
      if(!lastTs) lastTs = ts;
      let dt = (ts - lastTs) / 1000;
      if (dt > 0.05) dt = 0.05; // cap dt spikes
      lastTs = ts;

      // trail fade
      ctx.fillStyle = `rgba(1,3,1,${RAIN.trail})`;
      ctx.fillRect(0,0,w,h);

      const maxRow = Math.ceil(h / glyphSpacing);

      for (let i=0;i<cols;i++) {
        rowFrac[i] += velRows[i] * dt;

        let steps = Math.floor(rowFrac[i]);
        if (steps > 0) {
          if (steps > RAIN.maxGlyphStepsPerFrame) {
            yRows[i] += (steps - RAIN.maxGlyphStepsPerFrame);
            steps = RAIN.maxGlyphStepsPerFrame;
          }
          rowFrac[i] -= Math.floor(rowFrac[i]);

          for (let s = 0; s < steps; s++) {
            yRows[i] += 1;
            const row = Math.floor(yRows[i]);

            if (row > maxRow) {
              yRows[i]   = - (10 + Math.random()*40);
              rowFrac[i] = 0;
              lastRow[i] = -1;
              velRows[i] = sampleVel();
              break;
            }

            if (row !== lastRow[i]) {
              const x = i * glyphSpacing;
              const y = row * glyphSpacing;
              const ch = glyphs[(Math.random() * glyphs.length) | 0];
              ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--rainColor').trim();
              ctx.fillText(ch, x, y);
              lastRow[i] = row;
            }
          }
        }
      }
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  })();

  // ======= LOAD SECTION TEXT (on first open) =======
  (function lazyLoadSections(){
    const year = document.getElementById('y');
    if (year) year.textContent = new Date().getFullYear();

    document.querySelectorAll('details.card').forEach(det => {
      const content = det.querySelector('.content');
      const src = content && content.getAttribute('data-src');

      let loaded = false;
      async function loadIfNeeded(){
        if (loaded || !src) return;
        try{
          const res = await fetch(src, {cache:'no-cache'});
          if(!res.ok) throw new Error('HTTP '+res.status);
          const txt = await res.text();
          content.textContent = (txt && txt.trim()) ? txt : '(No content in ' + src + ')';
        }catch(err){
          content.textContent = '(Could not load ' + src + ' — create this file next to index.html)';
        }
        loaded = true;
      }
      det.addEventListener('toggle', () => { if (det.open) loadIfNeeded(); }, {passive:true});
      // Auto-load the first section for convenience:
      if (det.id === 'sec-about') {
        det.setAttribute('open','');
        loadIfNeeded();
      }
    });
  })();
  </script>
</body>
</html>
